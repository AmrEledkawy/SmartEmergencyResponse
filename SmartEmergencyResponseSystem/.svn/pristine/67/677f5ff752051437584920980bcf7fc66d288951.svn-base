classdef RequestManager < handle
    %% Class to keep track of requests
    
    properties (Access = private)
        requests    % Vector of Request objects
    end
    
    methods
        function addRequest(obj,locationIn,...
                                itemIn,...
                                senderIn,...
                                priorityIn,...
                                dueTimeIn,...
                                deliverAfterIn,...
                                isDeliveryIn,...
                                isPickupIn)
            newRequest = Request(locationIn,   itemIn,...
                                 senderIn,     priorityIn,...
                                 dueTimeIn,    deliverAfterIn,...
                                 isDeliveryIn, isPickupIn);            
            obj.requests = [obj.requests newRequest];
            notify(obj,'requestAdded',EventWithID(newRequest));
        end        
        
        function retval = getRequests(obj)
            retval = obj.requests;
        end
        
        function removeRequest(obj, ID)
            delete(obj.requests(ID));
            notify(obj,'requestRemoved',EventWithID(ID));
        end
        
        function retval = getID(obj)
            IDs = zeros(1,numel(obj.requests));
            for ii = 1:numel(obj.requests)
                if isvalid(obj.requests(ii))
                    IDs(ii) = obj.requests(ii).ID;
                end
            end
            retval = find(sort(IDs)-(1:numel(IDs)),1,'first');
            
            if isempty(retval)
                if isempty(IDs)
                    retval = 1;
                else
                    retval = max(IDs(:))+1;
                end
            end
        end        
    end
    
    events
        requestAdded
        requestRemoved
    end    
end

