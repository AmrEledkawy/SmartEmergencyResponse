classdef Kuka < ConnectedVehicle
    %% Haptics Device, few details available at this time
    properties (Access = private)
        % Configurable properties to be agreed on with Bluhaptics
        
        %GPSipAddress = '172.28.208.200'
        ConnectionipAddress = '127.0.0.1';
        ConnectionPortNumber = 2345;
        % Other properties
        connection
        datagramListener
        heading
    end
    
    methods
        function obj = Kuka(portIn,IDIn,LocationIn)
            obj = obj@ConnectedVehicle(portIn,IDIn,LocationIn); % Random Id and location for the vehicle
            obj.connection = KukaConnection(obj.ConnectionipAddress,obj.ConnectionPortNumber);
            obj.datagramListener = addlistener(obj.connection,'datagramReceived',@obj.unpackDatagram);
        end
        
        function delete(obj)
            delete(obj.datagramListener);
            delete(obj.connection);
        end
    end
    
    methods (Access = private)
        function unpackDatagram(obj,~,~)
            obj.location = [obj.connection.lastData.latitude obj.connection.lastData.longitude];
            obj.heading = obj.connection.lastData.heading;
        end
    end
end

