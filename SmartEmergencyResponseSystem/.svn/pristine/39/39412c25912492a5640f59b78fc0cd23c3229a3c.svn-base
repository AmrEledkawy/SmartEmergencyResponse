function [theaterXlim,theaterYlim] = matchup(varargin)
    if nargin < 2
        theaterXlim = [-122.46367, -122.3814388];
        theaterYlim = [37.773545, 37.811837];
    else
        theaterXlim = varargin{1};
        theaterYlim = varargin{2};
    end

imData = imread('SFHiRes.png');
[nodes, ~, deployment] = loadNodeDataFromMapFile('SanFrancisco.map');

mainFig = figure;
mainMap = axes(...
'Parent',mainFig,...
'Position',[0 0 1 1],...
'LooseInset',[0.108274411204147 0.096423165532088 0.0791236081876461 0.0657430674082418],...
'XTick',[],...
'YTick',[],...
'XLim',theaterXlim,...
'YLim',theaterYlim,...
'XLimMode','manual',...
'YLimMode','manual',...
'SortMethod','ChildOrder');

mapImage = image('CData',imData,...
                 'parent',mainMap,...
                 'hittest','off',...
                 'ydata',linspace(theaterYlim(2),theaterYlim(1),size(imData,1)),...
                 'xdata',linspace(theaterXlim(1),theaterXlim(2),size(imData,2)));
             
nodeOverlay = TransitGraphNodeOverlay(mainMap,...
                                      nodes,...
                                      deployment);
                                  
nodeOverlay.showNodes

controlfig = figure('position',[30,30,180,150]);
uicontrol('parent',controlfig,'position',[20,20,60,20],...
          'style','pushbutton','string','Move up','callback',@(~,~)move(0,.00002))
uicontrol('parent',controlfig,'position',[20,50,60,20],...
          'style','pushbutton','string','Move down','callback',@(~,~)move(0,-.00002))
uicontrol('parent',controlfig,'position',[20,80,60,20],...
          'style','pushbutton','string','Move left','callback',@(~,~)move(-.00002,0))
uicontrol('parent',controlfig,'position',[20,110,60,20],...
          'style','pushbutton','string','Move right','callback',@(~,~)move(.00002,0))

uicontrol('parent',controlfig,'position',[100,20,60,20],...
          'style','pushbutton','string','Stretch x','callback',@(~,~)stretch(0,.001))
uicontrol('parent',controlfig,'position',[100,50,60,20],...
          'style','pushbutton','string','Shrink x','callback',@(~,~)stretch(0,-.001))
uicontrol('parent',controlfig,'position',[100,80,60,20],...
          'style','pushbutton','string','Stretch y','callback',@(~,~)stretch(-.001,0))
uicontrol('parent',controlfig,'position',[100,110,60,20],...
          'style','pushbutton','string','Shrink y','callback',@(~,~)stretch(.001,0))


uiwait(mainFig)

    function move(x,y)
        theaterXlim = theaterXlim + x;
        theaterYlim = theaterYlim + y;
        set(mapImage,'xdata',linspace(theaterXlim(1),theaterXlim(2),size(imData,2)),...
                     'ydata',linspace(theaterYlim(2),theaterYlim(1),size(imData,1)));
    end

    function stretch(x,y)
        theaterXlim = [theaterXlim(1), theaterXlim(1)+(1-y)*diff(theaterXlim)];
        theaterYlim = [theaterYlim(1), theaterYlim(1)+(1-x)*diff(theaterYlim)];
        set(mapImage,'xdata',linspace(theaterXlim(1),theaterXlim(2),size(imData,2)),...
                     'ydata',linspace(theaterYlim(2),theaterYlim(1),size(imData,1)));

    end
end